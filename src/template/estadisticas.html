<!DOCTYPE html>
<html lang="en">

{{head|safe}}

<body class="homepage">
       <header id="header">
        <div class="top-bar">
            <div class="container">
                    <a href="http://www.ugr.es"><img id="logo-ugr" name="logo-ugr" src="../static/images/logo_ugr.png" alt="logo"></a>
                    <div id="mensaje_bienvenida" class="alert alert-success">Ha iniciado sesión como: <b>{{sesion}}</b></div>
                    <input id="boton-cerrar" name="boton-cerrar" type="button" value="Cerrar sesión" onclick="location.href='/logout';" class="btn btn-warning" />
            </div><!--/.container-->
        </div><!--/.top-bar-->

        <nav class="navbar navbar-inverse" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
				
                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        <li><a href="/">Inicio</a></li>
                        <li><a href="/grafico">Monitorización</a></li>
			<li><a href="/pronostico">Pronóstico</a></li>
                        <li class="active"><a href="/estadisticas">Estadísticas</a></li>
                        <li><a href="/geolocalizacion">Geolocalización</a></li>
                        <li><a href="/METAR_TAF">METAR-TAF</a></li>
                        <li><a href="/streaming">Streaming</a></li> 
                        <li><a href="/editar_perfil">Editar perfil</a></li>                        
                    </ul>
                </div>
            </div><!--/.container-->
        </nav><!--/nav-->
		
    </header><!--/header-->

   <div style="background:transparent !important" class="jumbotron">
    <div id="inputs">
    	<p>Fecha: <input type="text" id="datepicker" /></p>
    </div>
     <div class="panel panel-primary">
	<select name="tiempo" id="tiempo" >    
		<option value="diario" selected="selected">Diario</option>
		<option value="semanal">Semanal</option>>
		<option value="mensual">Mensual</option>>
		<option value="anual">Anual</option>
	</select>
      </div>	

   <script>
	$(document).ready(
	  
	function () {
	    $( "#datepicker" ).datepicker({
	      dateFormat: "dd-mm-yy",
	      changeMonth: true,
	      changeYear: true 
	    });
	  }
	);

	//Función que traduce el Datepicker Jquery a español

	$(function($){
	    $.datepicker.regional['es'] = {
		closeText: 'Cerrar',
		prevText: '<Ant',
		nextText: 'Sig>',
		currentText: 'Hoy',
		monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
		monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
		dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
		dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],
		dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],
		weekHeader: 'Sm',
		dateFormat: 'dd/mm/yy',
		firstDay: 1,
		isRTL: false,
		showMonthAfterYear: false,
		yearSuffix: ''
	    };
	    $.datepicker.setDefaults($.datepicker.regional['es']);
	});

       $('#tiempo').change(function(){
	  var tipo_tiempo = document.getElementById('tiempo').value;
	  window.tiempo = tipo_tiempo;      //Almacenamos la variable para poder usarla en el evento de abajo
          var tipo_dat = window.fecha;

	  $.ajax({
		  type: 'GET',
		  url: '/getDatosAtmosfericos?fecha=' + tipo_dat + '&tiempo=' + tipo_tiempo,
		  data: $(this).serialize(),
		  dataType: 'json',
		  success: function (data) {
			 $('table').html(
			    function(){
				var content = '<table class="table table-striped"><thead><tr><th>Fecha</th><th>Temperatura</th><th>Presión A.</th><th>Viento</th><th>Humedad</th></tr></thead><tbody>'; 
				for(var i = 0; i < data.length; i++){
				      content = content+'<tr><td style="font-size:14px;">' + data[i].fecha + '</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].temperatura + ' ºC</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].presion + ' hPa</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].vel_viento + ' kph - ' + data[i].dir_viento + ' º</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].humedad + '%</td>';
				}

				content = content + '</tr></tbody></table>';

				return content;
			    }
			)
		  }
          });
       });

       $('#datepicker').change(function () {		//Actualiza los datos al cambiar de fecha,sin recargar la página, utilizando AJAX

	  var tipo_dato = document.getElementById('datepicker').value;
	  window.fecha = tipo_dato;
	  var tipo_tiem = window.tiempo;		//Recuperamos la variable anteriormente almacenada

	  $.ajax({
		  type: 'GET',
		  url: '/getDatosAtmosfericos?fecha=' + tipo_dato + '&tiempo=' + tipo_tiem,
		  data: $(this).serialize(),
		  dataType: 'json',
		  success: function (data) {
			 $('table').html(
			    function(){
				var content = '<table class="table table-striped"><thead><tr><th>Fecha</th><th>Temperatura</th><th>Presión A.</th><th>Viento</th><th>Humedad</th></tr></thead><tbody>'; 
				for(var i = 0; i < data.length; i++){
				      content = content+'<tr><td style="font-size:14px;">' + data[i].fecha + '</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].temperatura + ' ºC</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].presion + ' hPa</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].vel_viento + ' kph - ' + data[i].dir_viento + ' º</td>';
				      content = content + '<td style="font-size:16px;">' + data[i].humedad + '%</td>';
				}

				content = content + '</tr></tbody></table>';

				return content;
			    }
			)
		  }
          });
       });

   </script>
 
<table class="table1 table-striped">

<thead><tr>
<th>Fecha</th><th>Temperatura</th><th>Presión A.</th><th>Viento</th><th>Humedad</th></tr></thead>
<tbody>

	  {% for datos in datos_atmos %}

	  <tr>
	      <td style="font-size:14px;">{{datos.fecha}}</td>
	      <td style="font-size:16px;">{{datos.temperatura}} ºC</td>
	      <td style="font-size:16px;">{{datos.presion}} hPa </td>
	      <td style="font-size:16px;">{{datos.vel_viento}} kph - {{datos.dir_viento}} º</td>
	      <td style="font-size:16px;">{{datos.humedad}} %</td>
          </tr>

	  {% endfor %}

</tbody>
</table>
</div>

{{footer|safe}}

</body>
</html>
